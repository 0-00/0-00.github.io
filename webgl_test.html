<html>
  <head>
    <script id="vertex" type="x-shader">
      attribute vec2 coordinates;
      attribute vec2 offset;

      void main() {
          gl_Position = vec4(coordinates+offset, 0.0, 1.0);
      }
    </script>
    <script id="fragment" type="x-shader">
      #ifdef GL_ES
      precision highp float;
      #endif

      void main() {
          gl_FragColor = vec4(1.0,1.0,1.0,1.0);
      }
    </script>
    <script type="text/javascript">
      window.onload = function () {
        /*============ Creating a canvas =================*/

        let cursorX = 0;
        let cursorY = 0;
        let boxX = 16;
        let boxY = 16;
        var fontsheetX = 16;
        var fontsheetY = 16;
        var fontsizeX = 10;
        var fontsizeY = 10;
        var consoleX = 72;
        var consoleY = 40;

        var scale = 1.0;
        canvas = document.getElementById("myCanvas");
        gl = canvas.getContext("webgl2", { antialias: false });

        scaleX = document.body.clientWidth / (consoleX * fontsizeX);
        scaleY = document.body.clientHeight / (consoleY * fontsizeY);

        scale = scaleY; //X > scaleY ? scaleX : scaleY;

        canvas.width = consoleX * fontsizeX * scale;
        canvas.height = consoleY * fontsizeY * scale;

        /*============= Clear canvas ================*/

        gl.viewport(0, 0, canvas.width, canvas.height);
        gl.clearColor(0, 0, 0, 1);
        gl.clear(gl.COLOR_BUFFER_BIT);

        /*====================== Init Shaders =======================*/

        var v = document.getElementById("vertex").firstChild.nodeValue;
        var f = document.getElementById("fragment").firstChild.nodeValue;

        var vs = gl.createShader(gl.VERTEX_SHADER);
        gl.shaderSource(vs, v);
        gl.compileShader(vs);

        var fs = gl.createShader(gl.FRAGMENT_SHADER);
        gl.shaderSource(fs, f);
        gl.compileShader(fs);

        program = gl.createProgram();
        gl.attachShader(program, vs);
        gl.attachShader(program, fs);
        gl.linkProgram(program);

        gl.useProgram(program);

        var offset_attrib_loc = gl.getAttribLocation(program, "offset");
        var coordinates_loc = gl.getAttribLocation(program, "coordinates");

        /*========== Defining and storing the geometry =========*/

        var pixel_unit_x = 2 / (consoleX * fontsizeX);
        var pixel_unit_y = 2 / (consoleY * fontsizeY);

        var quad_vertices = new Float32Array([
          -pixel_unit_x,
          -pixel_unit_y,
          pixel_unit_x,
          -pixel_unit_y,
          -pixel_unit_x,
          pixel_unit_y,
          -pixel_unit_x,
          pixel_unit_y,
          pixel_unit_x,
          -pixel_unit_y,
          pixel_unit_x,
          pixel_unit_y,
        ]);

        offset_data = [];

        const add_pixel = (x, y) => {
          var newX = (2 * x) / (consoleX * fontsizeX) - 1;
          var newY = -((2 * y) / (consoleY * fontsizeY) - 1);
          offset_data.push(newX, newY);
        };

        add_pixel(0, 0);
        add_pixel(consoleX * fontsizeX, consoleY * fontsizeY);

        var offset_array = new Float32Array(offset_data);

        var vertex_count = quad_vertices.length / 2;
        var instance_count = offset_array.length / 2;

        // Create and bind VAO
        vao = gl.createVertexArray();
        gl.bindVertexArray(vao);

        // Create and populate quad VBO
        vbuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, vbuffer);
        gl.bufferData(gl.ARRAY_BUFFER, quad_vertices, gl.STATIC_DRAW);

        // Point coordinates attribute to quad VBO
        gl.enableVertexAttribArray(coordinates_loc);
        gl.vertexAttribPointer(coordinates_loc, 2, gl.FLOAT, false, 0, 0);

        // Create and populate instance VBO
        instance_buffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, instance_buffer);
        gl.bufferData(gl.ARRAY_BUFFER, offset_array, gl.DYNAMIC_DRAW);

        // Point offsets attribute to instance VBO
        gl.enableVertexAttribArray(offset_attrib_loc);
        gl.vertexAttribPointer(offset_attrib_loc, 2, gl.FLOAT, false, 0, 0);
        gl.vertexAttribDivisor(offset_attrib_loc, 1);

        // Unbind buffer
        gl.bindBuffer(gl.ARRAY_BUFFER, null);

        /*============= Drawing the Quads ================*/

        gl.bindVertexArray(vao);
        gl.drawArraysInstanced(gl.TRIANGLES, 0, vertex_count, instance_count);
        // gl.drawArrays(gl.TRIANGLES, 0, quad_vertices.length / 2);
      };
    </script>
    <style>
      body {
        background-color: green;
      }

      canvas {
        position: absolute;
        top: 50%;
        left: 50%;
        margin-right: -50%;
        transform: translate(-50%, -50%);
        image-rendering: pixelated;
      }
    </style>
  </head>
  <body>
    <canvas id="myCanvas"></canvas>
  </body>
</html>
